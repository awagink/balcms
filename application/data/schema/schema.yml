---
detect_relations: false

Route:
    actAs:
        BalAuditable:
        Searchable:
            fields: [path]
    columns:
        id:
            primary: true
            type: integer(4)
            unsigned: true
        path:
            type: string(150)
            notblank: true
        type:
            type: string(15)
            notblank: true
        data:
            type: array

Content:
    actAs:
        NestedSet:
            hasManyRoots: true
            rootColumnName: root_id
        BalAuditable:
            status:
                disabled: false
            enabled:
                disabled: false
            author:
                disabled: false
            created_at:
                disabled: false
            updated_at:
                disabled: false
            published_at:
                disabled: false
        Searchable:
            fields: [code, tagstr, authorstr, title, description]
        Taggable:
    columns:
        id:
            primary: true
            type: integer(4)
            unsigned: true
        code:
            type: string(30)
            notblank: true
        title:
            type: string(50)
            notblank: true
        description:
            type: string
            notblank: true
            extra:
                html: rich
        description_rendered:
            type: string
            notblank: true
            extra:
                html: rich
        authorstr:
            type: string(50)
            notnull: true
            default: ""
        tagstr:
            type: string(255)
            notnull: true
            default: ""
        content:
            type: string
            notblank: true
            extra:
                html: rich
        content_rendered:
            type: string
            notblank: true
            extra:
                html: rich
        system:
            type: boolean
            default: false
            notnull: true
            
        avatar_id:
            type: integer(4)
            unsigned: true
        route_id:
            type: integer(4)
            unsigned: true
            unique: true
            notnull: true
            
        send_at:
            type: timestamp
        send_finished_at:
            type: timestamp
        send_all:
            type: integer(4)
            notnull: true
            default: 0
        send_remaining:
            type: integer(4)
            notnull: true
            default: 0
        send_status:
            type: enum
            values: [none,pending,completed]
            default: none
            notblank: true
    relations:
        Avatar:
            class: File
            local: avatar_id
            foreign: id
        Route:
            local: route_id
            foreign: id
        Subscribers:
            class: Subscriber
            local: content_id
            foreign: subscriber_id
            foreignAlias: ContentList
            refClass: ContentAndSubscriber

Event:
    actAs:
        BalContentExtension:
    columns:
        start_at:
            type: timestamp
        finish_at:
            type: timestamp
        venue_id:
            type: integer(4)
            unsigned: true
    relations:
        Venue:
            local: venue_id
            foreign: id

Venue:
    actAs:
        BalContentExtension:
    columns:
        google_map_uri:
            type: string(255)

ContentAndSubscriber:
    columns:
        id:
            primary: true
            type: integer(4)
            unsigned: true
        content_id:
            type: integer(4)
            unsigned: true
        subscriber_id:
            type: integer(4)
            unsigned: true
        status:
            type: enum
            values: [pending,sending,delivered,failed]
            default: pending
            notnull: true
    relations:
        Content:
            local: content_id
            foreign: id
        Subscriber:
            local: subscriber_id
            foreign: id

Subscriber:
    actAs:
         Taggable:
    columns:
        id:
            primary: true
            type: integer(4)
            unsigned: true
        email:
            type: string(255)
            notnull: true
            unique: true
        enabled:
            type: boolean
            notnull: true
            default: true

File:
    actAs:
        BalAuditable:
            status:
                disabled: true
            enabled:
                disabled: true
            author:
                disabled: false
            created_at:
                disabled: false
            updated_at:
                disabled: false
            published_at:
                disabled: true
    columns:
        id:
            primary: true
            type: integer(4)
            unsigned: true
        code:
            type: string(255)
            unique: true
            notblank: true
        name:
            type: string(255)
            notblank: true
        path:
            type: string(255)
            notblank: true
        size:
            type: integer(4)
        type:
            type: enum
            values: [file,document,image,video,audio,web,application,archive]
            default: unknown
            notnull: true
        mimetype:
            type: string(20)
            notnull: true
        width:
            type: integer(2)
            unsigned: true
        height:
            type: integer(2)
            unsigned: true

User:
    actAs:
        Searchable:
            fields: [username,displayname,fullname,email]
    columns:
        id:
            type: integer(4)
            primary: true
            autoincrement: true
            unsigned: true
        username:
            type: string(15)
            notblank: true
            unique: true
        password:
            type: string(10)
            notblank: true
        enabled:
            type: boolean
            notnull: true
            default: true
        displayname:
            type: string(50)
            notblank: true
        fullname:
            type: string(255)
            notblank: true
        email:
            type: string(255)
            notblank: true
    relations:
        Permissions:
            class: Permission
            local: user_id
            foreign: permission_id
            foreignAlias: Users
            refClass: PermissionAndUser
        PermissionGroups:
            class: PermissionGroup
            local: user_id
            foreign: permissiongroup_id
            foreignAlias: Users
            refClass: PermissionGroupAndUser

PermissionGroup:
    columns:
        id:
            type: integer(2)
            primary: true
            autoincrement: true
            unsigned: true
        code:
            type: string(15)
            notblank: true
            unique: true
    relations:
        PermissionList:
            class: Permission
            local: permissiongroup_id
            foreign: permission_id
            foreignAlias: PermissionGroups
            refClass: PermissionAndPermissionGroup

PermissionAndPermissionGroup:
    columns:
        id:
            type: integer(4)
            primary: true
            autoincrement: true
            unsigned: true
        permissiongroup_id:
            type: integer(2)
            unsigned: true
            notnull: true
        permission_id:
            type: integer(2)
            unsigned: true
            notnull: true
    relations:
        PermissionGroup:
            local: permissiongroup_id
            foreign: id
        Permission:
            local: permission_id
            foreign: id
        
Permission:
    columns:
        id:
            type: integer(2)
            primary: true
            autoincrement: true
            unsigned: true
        code:
            type: string(50)
            notblank: true
            unique: true

PermissionGroupAndUser:
    columns:
        id:
            type: integer(4)
            primary: true
            autoincrement: true
            unsigned: true
        assigned_date:
            type: timestamp
            notnull: false
        assignee_user_id:
            type: integer(4)
            notnull: false
            unsigned: true
        user_id:
            type: integer(4)
            notnull: true
            unsigned: true
        permissiongroup_id:
            type: integer(2)
            notnull: true
            unsigned: true
    relations:
        Assignee:
            class: User
            local: assignee_user_id
            foreign: id
        User:
            local: user_id
            foreign: id
        PermissionGroup:
            local: permissiongroup_id
            foreign: id

PermissionAndUser:
    columns:
        id:
            type: integer(6)
            primary: true
            autoincrement: true
            unsigned: true
        assigned_date:
            type: timestamp
            notnull: false
        assignee_user_id:
            type: integer(4)
            notnull: false
            unsigned: true
        user_id:
            type: integer(4)
            notnull: true
            unsigned: true
        permission_id:
            type: integer(2)
            notnull: true
            unsigned: true
    relations:
        Assignee:
            class: User
            local: assignee_user_id
            foreign: id
        User:
            local: user_id
            foreign: id
        Permission:
            local: permission_id
            foreign: id
