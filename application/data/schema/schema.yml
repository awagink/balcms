---
detect_relations: false

Route:
    actAs:
        SoftDelete:
        Searchable:
            fields: [path]
    columns:
        id:
            primary: true
            type: integer(4)
            unsigned: true
            autoincrement: true
        path:
            type: string(150)
            notblank: true
            unique: true
        type:
            type: string(15)
            notblank: true
        data:
            type: array

Content:
    actAs:
        SoftDelete:
        BalAuditable:
            status:
                disabled: false
            enabled:
                disabled: false
            author:
                disabled: false
            created_at:
                disabled: false
            updated_at:
                disabled: false
            published_at:
                disabled: false
        Searchable:
            fields: [code, tagstr, authorstr, title, description]
        Taggable:
    columns:
        id:
            primary: true
            type: integer(4)
            unsigned: true
            autoincrement: true
        code:
            type: string(30)
            notblank: true
            unique: true
        title:
            type: string(50)
            notblank: true
        description:
            type: string
            notblank: true
            extra:
                html: rich
        description_rendered:
            type: string
            notblank: true
            extra:
                html: rich
        authorstr:
            type: string(50)
            notnull: true
            default: ""
        tagstr:
            type: string(255)
            notnull: true
            default: ""
        content:
            type: string
            notblank: true
            extra:
                html: rich
        content_rendered:
            type: string
            notblank: true
            extra:
                html: rich
            
        avatar_id:
            type: integer(4)
            unsigned: true
        route_id:
            type: integer(4)
            unsigned: true
            unique: true
        parent_id:
            type: integer(4)
            unsigned: true
        position:
            type: integer(2)
            unsigned: true
            notnull: true
            default: 0
            
        send_at:
            type: timestamp
        send_finished_at:
            type: timestamp
        send_all:
            type: integer(4)
            notnull: true
            default: 0
        send_remaining:
            type: integer(4)
            notnull: true
            default: 0
        send_status:
            type: enum
            values: [none,pending,completed]
            default: none
            notblank: true
            
        type:
            type: enum
            values: [content,event]
            default: content
            notblank: true
    relations:
        Avatar:
            class: Media
            local: avatar_id
            foreign: id
            foreignAlias: ContentList
            onDelete: "SET NULL"
        Route:
            local: route_id
            foreign: id
            foreignAlias: ContentList
            onDelete: CASCADE
        Parent:
            class: Content
            local: parent_id
            foreign: id
            foreignAlias: Children
            onDelete: CASCADE
        Subscribers:
            class: Subscriber
            local: content_id
            foreign: subscriber_id
            foreignAlias: ContentList
            refClass: ContentAndSubscriber
            onDelete: CASCADE

Event:
    inheritance:
        extends: Content
        type: column_aggregation
        keyField: type
        keyValue: event
    columns:
        event_start_at:
            type: timestamp
        event_finish_at:
            type: timestamp
        event_content:
            type: string
            extra:
                html: rich

ContentAndSubscriber:
    columns:
        id:
            primary: true
            type: integer(4)
            unsigned: true
            autoincrement: true
        content_id:
            type: integer(4)
            unsigned: true
        subscriber_id:
            type: integer(4)
            unsigned: true
        status:
            type: enum
            values: [pending,sending,delivered,failed]
            default: pending
            notnull: true
    relations:
        Content:
            local: content_id
            foreign: id
        Subscriber:
            local: subscriber_id
            foreign: id

Subscriber:
    actAs:
        Taggable:
        Searchable:
            fields: [email,tagstr]
    columns:
        id:
            primary: true
            type: integer(4)
            unsigned: true
            autoincrement: true
        email:
            type: string(255)
            notnull: true
            unique: true
        enabled:
            type: boolean
            notnull: true
            default: true
        tagstr:
            type: string(255)
            notnull: true
            default: ""

Media:
    actAs:
        BalAuditable:
            status:
                disabled: true
            enabled:
                disabled: true
            author:
                disabled: false
            created_at:
                disabled: false
            updated_at:
                disabled: false
            published_at:
                disabled: true
        Searchable:
            fields: [code,title,path,type]
    columns:
        id:
            primary: true
            type: integer(4)
            unsigned: true
            autoincrement: true
        code:
            type: string(255)
            notblank: true
            unique: true
        title:
            type: string(255)
            notblank: true
        extension:
            type: string(3)
            notnull: true
        path:
            type: string(255)
            notblank: true
        relativepath:
            type: string(255)
            notblank: true
        url:
            type: string(255)
            notblank: true
        size:
            type: integer(4)
            notnull: true
        type:
            type: enum
            values: [file,document,image,video,audio,web,application,archive]
            default: unknown
            notnull: true
        mimetype:
            type: string(20)
            notnull: true
        humantype:
            type: string(20)
            notnull: true
        width:
            type: integer(2)
            unsigned: true
        height:
            type: integer(2)
            unsigned: true

User:
    actAs:
        SoftDelete:
        Searchable:
            fields: [username,displayname,fullname,email]
    columns:
        id:
            type: integer(4)
            primary: true
            autoincrement: true
            unsigned: true
            autoincrement: true
        username:
            type: string(15)
            notblank: true
            unique: true
        password:
            type: string(10)
            notblank: true
        enabled:
            type: boolean
            notnull: true
            default: true
        displayname:
            type: string(50)
            notblank: true
        fullname:
            type: string(255)
            notblank: true
        email:
            type: string(255)
            notblank: true
    relations:
        Permissions:
            class: Permission
            local: user_id
            foreign: permission_id
            foreignAlias: Users
            refClass: PermissionAndUser
        Roles:
            class: Role
            local: user_id
            foreign: role_id
            foreignAlias: Users
            refClass: RoleAndUser

Role:
    columns:
        id:
            type: integer(2)
            primary: true
            autoincrement: true
            unsigned: true
            autoincrement: true
        code:
            type: string(15)
            notblank: true
            unique: true
    relations:
        PermissionList:
            class: Permission
            local: role_id
            foreign: permission_id
            foreignAlias: Roles
            refClass: PermissionAndRole

PermissionAndRole:
    columns:
        id:
            type: integer(4)
            primary: true
            unsigned: true
            autoincrement: true
        role_id:
            type: integer(2)
            unsigned: true
            notnull: true
        permission_id:
            type: integer(2)
            unsigned: true
            notnull: true
    relations:
        Role:
            local: role_id
            foreign: id
        Permission:
            local: permission_id
            foreign: id
        
Permission:
    columns:
        id:
            type: integer(2)
            primary: true
            unsigned: true
            autoincrement: true
        code:
            type: string(50)
            notblank: true
            unique: true

RoleAndUser:
    columns:
        id:
            type: integer(4)
            primary: true
            unsigned: true
            autoincrement: true
        assigned_date:
            type: timestamp
            notnull: false
        assignee_user_id:
            type: integer(4)
            notnull: false
            unsigned: true
        user_id:
            type: integer(4)
            notnull: true
            unsigned: true
        role_id:
            type: integer(2)
            notnull: true
            unsigned: true
    relations:
        Assignee:
            class: User
            local: assignee_user_id
            foreign: id
        User:
            local: user_id
            foreign: id
        Role:
            local: role_id
            foreign: id

PermissionAndUser:
    columns:
        id:
            type: integer(6)
            primary: true
            unsigned: true
            autoincrement: true
        assigned_date:
            type: timestamp
            notnull: false
        assignee_user_id:
            type: integer(4)
            notnull: false
            unsigned: true
        user_id:
            type: integer(4)
            notnull: true
            unsigned: true
        permission_id:
            type: integer(2)
            notnull: true
            unsigned: true
    relations:
        Assignee:
            class: User
            local: assignee_user_id
            foreign: id
        User:
            local: user_id
            foreign: id
        Permission:
            local: permission_id
            foreign: id
