
# ==============================================
# BAL MEDIA

BalMedia:
    actAs:
        Sluggable:
            name: code
            canUpdate: true
            fields: [name]
        Bal_Doctrine_Template_Auditable:
            status:
                disabled: true
            author:
                disabled: false
            authorstr:
                disabled: true
            created_at:
                disabled: false
            updated_at:
                disabled: false
            published_at:
                disabled: true
        Searchable:
            fields: [code,title,path,type]
    columns:
        id:
            primary: true
            type: integer(2)
            unsigned: true
            autoincrement: true
        name:
            type: string(255)
            notblank: true
            unique: true
        title:
            type: string(255)
            notblank: true
        extension:
            type: string(3)
            notnull: true
        path:
            type: string(255)
            notblank: true
        size:
            type: integer(4)
            notnull: true
        type:
            type: enum
            values: [file,document,image,video,audio,web,application,archive]
            default: unknown
            notnull: true
        mimetype:
            type: string(20)
            notnull: true
        humantype:
            type: string(20)
            notnull: true
        width:
            type: integer(2)
            unsigned: true
        height:
            type: integer(2)
            unsigned: true
        url: #auto
            type: string(255)


# ==============================================
# BAL MESSAGE
  
BalMessage:
    columns:
        id:
            type: integer(3)
            unsigned: true
            primary: true
            autoincrement: true
        send_on:
            type: timestamp
            notblank: true
        sent_on:
            type: timestamp
        title:
            type: string(50)
            notblank: true
        description:
            type: string
            notblank: true
            extra:
                html: true
        unread:
            type: boolean
            default: true
            notnull: true
        code:
            type: string(33)
            unique: true
            notblank: true
        
        status:
            type: enum
            notblank: true
            values: [pending,published]
            default: pending
        template:
            type: string(30)
            notblank: true
            default: "user-message"
        sender_id:
            type: integer(2)
            unsigned: true
        receiver_id:
            type: integer(2)
            unsigned: true
            notblank: true
    relations:
        Sender:
            class: User
            local: sender_id
            foreign: id
            foreignAlias: SentMessages
        Receiver:
            class: User
            local: receiver_id
            foreign: id
            foreignAlias: ReceivedMessages

# ==============================================
# BAL USER

BalUser:
    actAs:
        Taggable:
            tagAlias: "SubscriptionTags"
        SoftDelete:
        Timestampable:
        Bal_Doctrine_Template_Loggable:
        Bal_Doctrine_Template_Addressable:
            # This can only be listed once due to bug in doctrine
    columns:
        id:
            type: integer(2)
            unsigned: true
            primary: true
            autoincrement: true
        username:
            type: string(16)
            notblank: true
            unique: true
            extra:
                auto: true
        password:
            # md5 hash
            type: string(33)
            notblank: true
        displayname:
            # The Name to Display the User As
            type: string(85)
            notblank: true
            
        title:
            type: string(15)
        firstname:
            type: string(35)
        lastname:
            type: string(35)
        fullname:
            type: string(85)
            extra:
                auto: true
            
        email:
            type: string(255)
            notblank: true
            #email: true
        phone:
            type: string(255)
            extra:
                formOrder: 320
                formGroup: "other"
            
        description:
            type: string
            
        subscriptions:
            # - CSV generated from SubscriptionTags. Used for searchable.
            type: string(255)
            notnull: true
            default: ""
        code:
            # Alias for Username
            type: string(33)
            notblank: true
            unique: true
            extra:
                auto: true
        uid:
            # Unique Identifier for the User
            type: string(33)
            notblank: true
            unique: true
            extra:
                auto: true
        type:
            type: enum
            values: [user]
            notblank: true
        status:
            type: enum
            values: [pending,published,disabled]
                # pending - Awaiting activation
                # published - Activated
                # disabled - Disabled for whatever reason
            notnull: true
            default: pending
            
        avatar_id:
            type: integer(2)
            unsigned: true
    relations:
        Avatar:
            class: Media
            local: avatar_id
            foreign: id
            foreignAlias: UserList
            onDelete: "SET NULL"
        Permissions:
            class: Permission
            local: user_id
            foreign: permission_id
            foreignAlias: Users
            refClass: PermissionAndUser
        Roles:
            class: Role
            local: user_id
            foreign: role_id
            foreignAlias: Users
            refClass: RoleAndUser

# ==============================================
# BAL PERMISSIONS

Role:
    columns:
        id:
            type: integer(2)
            primary: true
            autoincrement: true
            unsigned: true
            autoincrement: true
        code:
            type: string(15)
            notblank: true
            unique: true
    relations:
        Permissions:
            class: Permission
            local: role_id
            foreign: permission_id
            foreignAlias: Roles
            refClass: PermissionAndRole

PermissionAndRole:
    columns:
        id:
            type: integer(2)
            primary: true
            unsigned: true
            autoincrement: true
        role_id:
            type: integer(2)
            unsigned: true
            notnull: true
        permission_id:
            type: integer(2)
            unsigned: true
            notnull: true
    relations:
        Role:
            local: role_id
            foreign: id
        Permission:
            local: permission_id
            foreign: id
        
Permission:
    columns:
        id:
            type: integer(2)
            primary: true
            unsigned: true
            autoincrement: true
        code:
            type: string(50)
            notblank: true
            unique: true

RoleAndUser:
    columns:
        id:
            type: integer(2)
            primary: true
            unsigned: true
            autoincrement: true
        assigned_date:
            type: timestamp
            notnull: false
        assignee_user_id:
            type: integer(2)
            notnull: false
            unsigned: true
        user_id:
            type: integer(2)
            notnull: true
            unsigned: true
        role_id:
            type: integer(2)
            notnull: true
            unsigned: true
    relations:
        Assignee:
            class: User
            local: assignee_user_id
            foreign: id
        User:
            local: user_id
            foreign: id
        Role:
            local: role_id
            foreign: id

PermissionAndUser:
    columns:
        id:
            type: integer(3)
            primary: true
            unsigned: true
            autoincrement: true
        assigned_date:
            type: timestamp
            notnull: false
        assignee_user_id:
            type: integer(2)
            notnull: false
            unsigned: true
        user_id:
            type: integer(2)
            notnull: true
            unsigned: true
        permission_id:
            type: integer(2)
            notnull: true
            unsigned: true
    relations:
        Assignee:
            class: User
            local: assignee_user_id
            foreign: id
        User:
            local: user_id
            foreign: id
        Permission:
            local: permission_id
            foreign: id
