<?php
	// Doctype
	echo $this->doctype('HTML5');
	// URL
	$baseFullUrl = $this->app()->getBaseUrl(true);
	$baseUrl = $this->app()->getBaseUrl();
	$publicUrl = $this->app()->getPublicUrl();
	$backUrl = $this->app()->getAreaUrl('back');
	$frontUrl = $this->app()->getAreaUrl('front');
	$scriptUrl = $publicUrl.'/scripts';
	$jqueryUiUrl = $scriptUrl.'/jquery-ui-1.7.2';
	$jquerySparkleUrl = $scriptUrl.'/jquery-sparkle';
	$tinyMceUrl = $scriptUrl.'/tiny_mce-3.2.7';
	$this->url()->renege('route','back');
	// Identity
	$Identity = $this->app()->getUser();
?><html>
<head>
    <?= $this->app()->headMeta() ?>
    <?= $this->app()->headTitle() ?>
    <?= $this->app()->headLink()->appendStylesheet($jqueryUiUrl.'/css/cupertino/jquery-ui-1.7.2.custom.css') ?>
    <?= $this->app()->headStyle() ?>
</head>
<body>
    <?
		$headScript = $this->app()->headScript()
		    // jQuery
			->offsetSetFile(20,APPLICATION_ENV === 'production' ? 'http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js' : $publicUrl.'/scripts/jquery-1.4.2.js')
			// UI
			->offsetSetFile(30,APPLICATION_ENV === 'production' ? 'http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js' : $jqueryUiUrl.'/js/jquery-ui-1.7.2.custom.min.js')
		    // TinyMCE
			->offsetSetFile(40,$tinyMceUrl.'/jquery.tinymce.js')
			->offsetSetScript(200,'$.Editor.applyConfig("default",{script_url: "'.$tinyMceUrl.'/tiny_mce.js", content_css: "'.$frontUrl.'/styles/content.css"});')
		    // Application
		    ->offsetSetFile(50,$publicUrl.'/scripts/jquery.autogrow.js')
		    ->offsetSetFile(60,$jquerySparkleUrl.'/scripts/jquery.sparkle.js')
		    ->offsetSetScript(65,'if ( typeof JSON === "undefined" ) $.appendScript("'.$scriptUrl.'/json2.js");')
			->offsetSetScript(201,'$.Help.applyConfig("default",{icon: \'<img src="'.$backUrl.'/images/help.png" alt="help" class="help-icon" />\'});')
			// Ajaxy
			//->appendFile($baseUrl.'/scripts/ajaxy/js/jquery.history.js')->appendFile($baseUrl.'/scripts/ajaxy/js/jquery.ajaxy.js')
			;
		if ( APPLICATION_ENV !== 'development' )
			$headScript
				// GSFN
		    	->offsetSetFile(80,'http://s3.amazonaws.com/getsatisfaction.com/javascripts/feedback-v2.js')
		    	->offsetSetScript(81,"var GSFN_feedback_widget = new GSFN.feedback_widget({ display: 'overlay', company: 'balupton', placement: 'hidden', color: '#222', style: 'question' });")
				;
	    echo $headScript;
    ?>
        <div id="wpwrap">
            <div id="wpcontent">
                <div id="wphead">
                    <!--<img id="header-logo" src="edit-pages.php_files/blank.gif" alt="" height="32" width="32">-->
                    <h1 id="site-heading"><a href="<?=$baseFullUrl?>" title="Visit Site">
                    	<span id="site-title"><?=$this->app()->getConfig('bal.site.name')?></span>
                    	<em id="site-visit-button">Visit Site</em>
                    </a></h1>
                    <div id="wphead-info">
                        <div id="user_info">
                            <p>
                                User: <?=delve($Identity,'displayname')?>
                                | <a href="<?=$this->url(array(),'balcmshelp',true)?>" class="gsfn">Feedback</a>
                                | <a href="<?=$this->url(array('action'=>'logout'),'back',true)?>" title="Log Out">Log Out</a>
                            </p>
                        </div>
	                    <?=true?'':$this->app()->getNavigationMenu('back.fav')->setPartial(array('navigation/favorites.phtml', 'default'))->render()?>
                    </div>
                </div>
                <div id="wpbody">
					<?
					
					try { echo $this->app()->getNavigationMenu('back.main')->setPartial(array('navigation/menu.phtml', 'default'))->render(); }
					catch ( Exception $e ) {
						echo $e->getMessage();
						die;
					}				
					?>
					<div id="wpbody-content">
                        <?= $this->layout()->content?>
                        <div class="clear">
                        </div>
                    </div>
                    <!-- wpbody-content -->
                    <div class="clear">
                    </div>
                </div>
                <!-- wpbody -->
                <div class="clear">
                </div>
            </div>
            <!-- wpcontent -->
        </div>
        <!-- wpwrap -->
        <div id="footer">
            <p id="footer-left" class="alignleft">
                <span id="footer-thankyou">Thank you for creating with <a href="<?=$this->url(array(),'balcmshome',true)?>">balCMS</a>.</span>
                | <a href="<?=$this->url(array(),'balcmsdocs',true)?>">Documentation</a>
                | <a href="<?=$this->url(array(),'balcmshelp',true)?>" class="gsfn">Feedback</a>
                | <a href="<?=$this->url(array(),'balcmshelp',true)?>">Support</a>
            </p>
            <p id="footer-upgrade" class="alignright">
                Version <?=$this->app()->getConfig('bal.site.version')?>
            </p>
            <div class="clear">
            </div>
        </div>
	</body>
</html>