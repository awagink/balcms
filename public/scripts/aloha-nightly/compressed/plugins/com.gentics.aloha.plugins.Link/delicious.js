if(!GENTICS.Aloha.Repositories)GENTICS.Aloha.Repositories={};GENTICS.Aloha.Repositories.delicious=new GENTICS.Aloha.Repository("com.gentics.aloha.repositories.delicious");GENTICS.Aloha.Repositories.delicious.settings.username="draftkraft";GENTICS.Aloha.Repositories.delicious.settings.weight=0.35;
GENTICS.Aloha.Repositories.delicious.init=function(){var a=this;if(this.settings.weight+0.15>1)this.settings.weight=0.85;this.deliciousURL="http://feeds.delicious.com/v2/json/";if(this.settings.username){this.deliciousURL+=this.settings.username+"/";this.repositoryName="deliciuos/"+this.settings.username;this.tags=[];jQuery.ajax({type:"GET",dataType:"jsonp",url:"http://feeds.delicious.com/v2/json/tags/"+a.settings.username,success:function(e){for(var b in e)a.tags.push(b)}})}else{this.repositoryName=
"deliciuos/"+popular;this.deliciousURL+="tag/"}};
GENTICS.Aloha.Repositories.delicious.query=function(a,e){var b=this;if(a.objectTypeFilter&&jQuery.inArray("website",a.objectTypeFilter)==-1)e.call(this,[]);else{var f=[];if(this.settings.username)for(var c=a.queryString?a.queryString.split(" "):[],h=0;h<c.length;h++){var i=c[h].trim();if(jQuery.inArray(i,b.tags)==-1){var g=b.tags.filter(function(d){var k=RegExp(i,"i");return d.match(k)});g.length>0&&f.push(g[0])}else f.push(i)}else f=a.queryString.split(" ");c=a.inFolderId?a.inFolderId.split("+"):
[];jQuery.extend(f,c);a.queryString&&f.length==0?e.call(b,[]):jQuery.ajax({type:"GET",dataType:"jsonp",url:b.deliciousURL+f.join("+"),success:function(d){for(var k=[],j=0;j<d.length;j++)typeof d[j]!="function"&&k.push(new GENTICS.Aloha.Repository.Document({id:d[j].u,name:d[j].d,repositoryId:b.repositoryId,type:"website",url:d[j].u,weight:b.settings.weight+0.14}));e.call(b,k)}})}};
GENTICS.Aloha.Repositories.delicious.getChildren=function(a,e){var b=this;if(this.settings.username){var f=[];if(a.inFolderId==this.repositoryId){for(var c=0;c<this.tags.length;c++)typeof this.tags[c]!="function"&&f.push(new GENTICS.Aloha.Repository.Folder({id:this.tags[c],name:this.tags[c],repositoryId:this.repositoryId,type:"tag",url:"http://feeds.delicious.com/v2/rss/tags/"+b.settings.username+"/"+this.tags[c]}));e.call(this,f)}else jQuery.ajax({type:"GET",dataType:"jsonp",url:"http://feeds.delicious.com/v2/json/tags/"+
b.settings.username+"/"+a.inFolderId,success:function(h){var i=[];for(var g in h){var d=a.inFolderId?a.inFolderId+"+"+g:g;typeof h[g]!="function"&&i.push(new GENTICS.Aloha.Repository.Folder({id:d,name:g,repositoryId:b.repositoryId,type:"tag",url:"http://feeds.delicious.com/v2/rss/tags/"+b.settings.username+"/"+d,hasMoreItems:true}))}e.call(b,i)}})}else e.call(this,[])};
